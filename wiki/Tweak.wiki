#labels Featured,Phase-Deploy,Phase-Support
#Tweak System to make optimize.

= Introduction =

except DistributionSystem  , you can optimize system.


= Details =

 # install alternate php cache php-apc
{{{
sudo apt-get install php-apc
}}}
 # tweak /etc/mysql/my.cnf  if you have more than 2G ram
{{{
[mysqld]
key_buffer              = 128M
query_cache_limit       = 4M
query_cache_size        = 128M
back_log                = 500
interactive_timeout     = 7200
max_connections         = 1024
thread_cache_size       = 80
wait_timeout            = 7200
tmp_table_size          = 128M
table_cache             = 256
}}}
 # set judge.conf to use MultiRUNNING

  * edit /home/judge/etc/judge.conf to set OJ_RUNNING=N (N>1)
  * mkdirs run1,run2.....run(N-1) make sure the chown judge and chmod 755
  * sudo pkill judged && sudo judged

  * important: in most case N should be no more than you CPU number*4.

 # cheat php to use memory for session
  * edit php.ini (/etc/php5/apache2/php.ini)
  * set session_save_path to somewhere under /dev/shm

= Test =
this test running no more then 10(half-page) pending on Dell D620 
{{{
#!/bin/bash
#use firebug to get the post data in file "post"
# change submit.php:121 to enable constant submit
# if (0&&mysql_num_rows($res)==1){

ab -c 100 -n 10000 http://127.1/JudgeOnline/status.php &
for i in {1..50}
do
   
   ab -q -c 10 -n 10 -T 'application/x-www-form-urlencoded' -p post -C PHPSESSID=d55d43ce050162e3701b64bfbd443ec1 http://127.1/JudgeOnline/submit.php
   sleep 10

done

}}}